Institution.joins(:debitor).where("institutions.creditor_id = ?", @creditor).select("debitors.*, sum(loan) as total_loan").group(:id,:debitor_id)





Institution.joins(:debitor).where("institutions.creditor_id = ?", @creditor).select("debitors.*, sum(loan) as total_loan").group(:id, :debitor_id)

or

@loans = Debitor.find_by_sql("select debitor_id, creditor_id, sum(loan) as total_loan from institutions where creditor_id = #{@creditor.id} group by debitor_id, creditor_id")




